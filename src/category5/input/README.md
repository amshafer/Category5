# Input Subsystem

This subsystem recieves less attention from the others, but is every
bit as important. It reads events from libinput and updates our
compositor state in reaction. It is heavily tied to `ways` through the
atmosphere, and is the least "standalone" of all the subsystems.

`input` runs in the same thread as `ways` for performance
reasons. Originally the design was for input to have its own thread,
and all three threads performed message passing to update each
other. This performed abysmally, both in regards to power efficiency
and runtime efficiency. On high refresh rate mice the amount of
messages generated by `input` was enormous and made the system
unusable. Additionally, being in the same thread means that we can use
kqueue to block on both the libinput fd and the libwayland fd, and
dispatch to the proper code when one of them is woken up.

The `input` code is also the ugliest of all the subsystems, and is
essentially a giant state machine that accepts libinput events and
generates atmosphere and wayland events. It uses xkbcommon to handle
keymaps and get the current keyboard state.

The main dispatch method is `handle_input_event`, and it is the
recommended starting place for new readers.